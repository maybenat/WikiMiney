<script src="https://code.jquery.com/jquery-2.1.3.min.js">
</script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/drilldown.js"></script>
<script src="../highcharts-regression.js">
</script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Muli:300' rel='stylesheet' type='text/css'>
<style>
h1 {
    font-family: 'Muli', sans-serif;
}
</style>
<script>
// $(function() {
function doData(inputty) {
        var pages, jsonData, frequencies, drilldownSeries, pagesData, date, dayData, pX, pY, regress;

        var json = $.getJSON("http://localhost:3000/data/year/2008/month/10/top/+" + inputty,
            function() {
                jsonData = json.responseJSON;
                arr = [];
                frequencies = [];
                pages = [];
                pagesData = [];
                drilldownSeries = [];
                date = [];
                dayData = [];
                pX = [];
                pY = [];
                regress = [];

                for (var j in jsonData) {
                    pages[j] = jsonData[j].page;
                    test = [];
                    test = jsonData[j].wikiviews[0].views;
                    frequencies[j] = test;

                    for (var k in jsonData[j].wikiviews) {
                        if (!date[jsonData[j].page]) {
                            date[jsonData[j].page] = [];
                        }
                        var day = jsonData[j].wikiviews[k].day;
                        date[jsonData[j].page].push(day, jsonData[j].wikiviews[k].views);
                        if (!dayData[jsonData[j].page]) {
                            dayData[jsonData[j].page] = [];
                        }
                        var numViews = jsonData[j].wikiviews[k].views;

                        dayData[jsonData[j].page].push(numViews);

                        drilldownSeries.push({
                            name: pages[j],
                            id: pages[j],
                            data: dayData[jsonData[j].page]
                        });

                        regress.push({
                            name: pages[j],
                            id: pages[j],
                            x: parseFloat(day),
                            y: parseFloat(numViews)
                        });
                        // pointsNStuff.push({
                        //     name: pages[j],
                        //     id: pages[j],
                        //     x: day,
                        //     y: dayData[jsonData[j].page]
                        // });



                    }

                    pagesData.push({
                        name: pages[j],
                        y: frequencies[j],
                        drilldown: date[pages[j]] ? pages[j] : null
                    });

                    console.log(dayData[jsonData[j].page]);

                }

                // Create the chart
                $('#container').highcharts({
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: 'Wiki Views'
                    },
                    // xAxis: {
                    //     type: 'category'
                    // },
                    yAxis: {
                        title: {
                            text: 'Total Views'
                        }
                    },

                    legend: {
                        enabled: true
                    },

                    plotOptions: {
                        spline: {
                            shadow: false,
                            marker: {
                                radius: 1
                            }
                        },
                        areaspline: {
                            color: 'rgb(69, 114, 167)',
                            fillColor: 'rgba(69, 114, 167,.25)',
                            shadow: false,
                            marker: {
                                radius: 1
                            }

                        },
                        series: {
                            borderWidth: 0,
                            dataLabels: {
                                enabled: true
                            }
                        }
                    },

                    series: [{
                        name: 'Frequencies',
                        colorByPoint: true,
                        data: pagesData,
                        // }],
                    }, {
                        name: 'Curve',
                        type: 'spline',
                        visible: false,
                        data: frequencies,
                        //color: 'rgba(204,204,255,.85)'
                    }, {
                        name: 'Filled Curve',
                        type: 'areaspline',
                        visible: false,
                        data: frequencies,
                        //color: 'rgba(204,204,255,.85)'
                    }],

                    drilldown: {
                        series: drilldownSeries,
                        id: 'primary'
                    }


                });

                $('#container2').highcharts({
                    chart: {
                        type: 'scatter',
                        zoomType: 'xy'
                    },
                    title: {
                        text: 'Page Views Vs Page Size'
                    },
                    xAxis: {
                        title: {
                            enabled: true,
                            text: 'Day'
                        },
                        showLastLabel: true
                    },
                    yAxis: {
                        title: {
                            text: 'Views'
                        }
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        verticalAlign: 'top',
                        // x: 100,
                        // y: 70,
                        floating: true,
                        backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                        borderWidth: 1
                    },
                    plotOptions: {
                        scatter: {
                            marker: {
                                radius: 5,
                                states: {
                                    hover: {
                                        enabled: true,
                                        lineColor: 'rgb(100,100,100)'
                                    }
                                }
                            },
                            states: {
                                hover: {
                                    marker: {
                                        enabled: false
                                    }
                                }
                            },
                            tooltip: {
                                headerFormat: '<b>{series.name}</b><br>',
                                pointFormat: 'Day: {point.x}, {point.y} views'
                            }
                        }
                    },
                    series: [{
                        regression: true,
                        regressionSettings: {
                            type: 'linear',
                            color: 'rgba(223, 83, 83, .9)'
                        },
                        colorByPoint: true,
                        data: regress,
                        // }],
                    }],

                });

            })

    }
    doData(10);
</script>
<center>
    <h1>Pages:</h1>
    <div class="btn-group btn-group-lg">
        <button id="2" class="btn btn-primary">2</button>
        <script>
        $('#2').on('click', function(e) {

            doData(2);

        })
        </script>
        <button id="5" class="btn btn-primary">5</button>
        <script>
        $('#5').on('click', function(e) {

            doData(5);

        })
        </script>
        <button id="10" class="btn btn-primary">10</button>
        <script>
        $('#10').on('click', function(e) {

            doData(10);

        })
        </script>
        <button id="15" class="btn btn-primary">15</button>
        <script>
        $('#15').on('click', function(e) {

            doData(15);

        })
        </script>
        <button id="20" class="btn btn-primary">20</button>
        <script>
        $('#20').on('click', function(e) {

            doData(20);

        })
        </script>
        <button id="30" class="btn btn-primary">30</button>
        <script>
        $('#30').on('click', function(e) {

            doData(30);

        })
        </script>
        <button id="40" class="btn btn-primary">40</button>
        <script>
        $('#40').on('click', function(e) {

            doData(40);

        })
        </script>
    </div>
</center>
<div id="container" style="height: 400px; min-width: 310px"></div>
<div id="container2" style="height: 400px; min-width: 310px"></div>