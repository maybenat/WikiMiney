<script src="https://code.jquery.com/jquery-2.1.3.min.js">
</script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/drilldown.js"></script>
<script src="../highcharts-regression.js">
</script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Muli:300' rel='stylesheet' type='text/css'>
<style>
customy {
    font-family: 'Muli', sans-serif;
    size: 15px;
}
</style>
<script>
// $(function() {
function doData(month, numIn) {
    var pages, jsonData, frequencies, drilldownSeries, pagesData, date, dayData, regress, byteSize, byteArr;

    var json = $.getJSON("http://localhost:3000/data/year/2008/month/" + month + "/top/" + numIn,
        function() {
            jsonData = json.responseJSON;
            arr = [];
            frequencies = [];
            pages = [];
            byteSize = [];
            pagesData = [];
            drilldownSeries = [];
            date = [];
            dayData = [];
            byteArr = [];
            regress = [];

            for (var j in jsonData) {
                pages[j] = jsonData[j].page;
                test = [];
                test = jsonData[j].wikiviews[0].views;

                for (var k in jsonData[j].wikiviews) {
                    if (!date[jsonData[j].page]) {
                        date[jsonData[j].page] = [];
                    }
                    var day = jsonData[j].wikiviews[k].day;

                    var monthy = jsonData[j].wikiviews[k].month;
                    var temp = month.toString();

                    if ((monthy === temp) && (day === "all")) {
                        frequencies[j] = jsonData[j].wikiviews[k].views;
                    }

                    if (!(day === "all")) {
                        date[jsonData[j].page].push([jsonData[j].wikiviews[k].month + "/" + day, jsonData[j].wikiviews[k].views]);
                        if (!dayData[jsonData[j].page]) {
                            dayData[jsonData[j].page] = [];
                        }
                        var numViews = jsonData[j].wikiviews[k].views;

                        var numBytes = jsonData[j].wikiviews[k].bytes;


                        numBytes = numBytes.toFixed(2);

                        if (!byteArr[jsonData[j].page]) {
                            byteArr[jsonData[j].page] = [];
                        }
                        byteArr[jsonData[j].page].push(numBytes);

                        dayData[jsonData[j].page].push(numViews);


                        byteSize.push({
                            name: pages[j],
                            id: pages[j],
                            data: byteArr[pages[j]]
                        });

                        drilldownSeries.push({
                            //     name: pages[j],
                            //     id: pages[j],
                            //     data: date[pages[j]]
                            // }, {
                            name: pages[j],
                            id: pages[j],
                            data: date[pages[j]],
                        });
                    }
                }


                var fullBytes = (jsonData[j].wikiviews[k].bytes) / numViews;

                fullBytes = fullBytes.toFixed(2);

                regress.push({
                    name: pages[j],
                    id: pages[j],
                    x: parseFloat(fullBytes),
                    y: parseFloat(frequencies[j])
                });

                pagesData.push({
                    name: pages[j],
                    y: frequencies[j],
                    drilldown: date[pages[j]] ? pages[j] : null
                });


            }


            // Create the chart
            $('#container').highcharts({
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Wiki Views'
                },
                xAxis: {
                    type: 'category'
                },
                yAxis: {
                    title: {
                        text: 'Total Views'
                    }
                },

                legend: {
                    enabled: true
                },

                plotOptions: {
                    spline: {
                        shadow: false,
                        marker: {
                            radius: 1
                        }
                    },
                    areaspline: {
                        color: 'rgb(69, 114, 167)',
                        fillColor: 'rgba(69, 114, 167,.25)',
                        shadow: false,
                        marker: {
                            radius: 1
                        }

                    },
                    series: {
                        borderWidth: 0,
                        dataLabels: {
                            enabled: false
                        }
                    }
                },

                series: [{
                    name: 'Frequencies',
                    colorByPoint: true,
                    data: pagesData,
                    // }],
                }, {
                    name: 'Curve',
                    type: 'spline',
                    visible: false,
                    data: frequencies,
                    //color: 'rgba(204,204,255,.85)'
                }, {
                    name: 'Filled Curve',
                    type: 'areaspline',
                    visible: false,
                    data: frequencies,
                    //color: 'rgba(204,204,255,.85)'
                }],

                drilldown: {
                    // series: drilldownSeries
                    series: drilldownSeries,
                }


            });

            $('#container2').highcharts({
                chart: {
                    type: 'scatter',
                    zoomType: 'xy'
                },
                title: {
                    text: 'Top Page vs Views Regression Line'
                },
                xAxis: {
                    title: {
                        enabled: true,
                        text: 'Bytes'
                    },
                    showLastLabel: true
                },
                yAxis: {
                    title: {
                        text: 'Views'
                    }
                },
                legend: {
                    layout: 'vertical',
                    align: 'left',
                    verticalAlign: 'top',
                    // x: 100,
                    // y: 70,
                    floating: true,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                    borderWidth: 1
                },
                plotOptions: {
                    scatter: {
                        marker: {
                            radius: 5,
                            states: {
                                hover: {
                                    enabled: true,
                                    lineColor: 'rgb(100,100,100)'
                                }
                            }
                        },
                        states: {
                            hover: {
                                marker: {
                                    enabled: false
                                }
                            }
                        },
                        tooltip: {
                            headerFormat: '',
                            pointFormat: '<b> {point.name} </b> Bytes: {point.x}, {point.y} views'
                        },
                        events: {
                            click: function(event, i) {
                               var win = window.open("http://www.en.wikipedia.org/wiki/"+event.point.name, '_blank');
                               win.focus();
                            }
                        },

                    }
                },
                series: [{
                    regression: true,
                    regressionSettings: {
                        type: 'linear',
                        color: 'rgba(223, 83, 83, .9)',
                        
                    },
                    colorByPoint: true,
                    data: regress,
                    // }],
                }],

            });

        })


}
doData(10, 10);
</script>
<p>&nbsp;</p>
<span id="currentPage">
<div class="span6" style="padding-left:30px;">
    <customy>10/2008:</customy>
    <div class="btn-group btn-group-med">
        <button id="5" class="btn btn-default">5</button>
        <script>
        $('#5').on('click', function(e) {

            doData(10, 5);

        })
        </script>
        <button id="10" class="btn btn-default">10</button>
        <script>
        $('#10').on('click', function(e) {

            doData(10, 10);

        })
        </script>
        <button id="20" class="btn btn-default">20</button>
        <script>
        $('#20').on('click', function(e) {

            doData(10, 20);

        })
        </script>
        <button id="30" class="btn btn-default">30</button>
        <script>
        $('#30').on('click', function(e) {

            doData(10, 30);

        })
        </script>
        <button id="40" class="btn btn-default">40</button>
        <script>
        $('#40').on('click', function(e) {

            doData(10, 40);

        })
        </script>
        <button id="50" class="btn btn-default">50</button>
        <script>
        $('#50').on('click', function(e) {

            doData(10, 50);

        })
        </script>
        </script>
        <button id="70" class="btn btn-default">70</button>
        <script>
        $('#70').on('click', function(e) {

            doData(10, 70);

        })
        </script>
    </div>
    <customy>11/2008:</customy>
    <div class="btn-group btn-group-med">
        <button id="511" class="btn btn-default">5</button>
        <script>
        $('#511').on('click', function(e) {

            doData(11, 5);

        })
        </script>
        <button id="1011" class="btn btn-default">10</button>
        <script>
        $('#1011').on('click', function(e) {

            doData(11, 10);

        })
        </script>
        <button id="2011" class="btn btn-default">20</button>
        <script>
        $('#2011').on('click', function(e) {

            doData(11, 20);

        })
        </script>
        <button id="3011" class="btn btn-default">30</button>
        <script>
        $('#3011').on('click', function(e) {

            doData(11, 30);

        })
        </script>
        <button id="4011" class="btn btn-default">40</button>
        <script>
        $('#4011').on('click', function(e) {

            doData(11, 40);

        })
        </script>
        <button id="7011" class="btn btn-default">70</button>
        <script>
        $('#7011').on('click', function(e) {

            doData(11, 70);

        })
        </script>
    </div>
    <customy>12/2008:</customy>
    <div class="btn-group btn-group-med">
        <button id="512" class="btn btn-default">5</button>
        <script>
        $('#512').on('click', function(e) {

            doData(12, 5);

        })
        </script>
        <button id="1012" class="btn btn-default">10</button>
        <script>
        $('#1012').on('click', function(e) {

            doData(12, 10);

        })
        </script>
        <button id="2012" class="btn btn-default">20</button>
        <script>
        $('#2012').on('click', function(e) {

            doData(12, 20);

        })
        </script>
        <button id="3012" class="btn btn-default">30</button>
        <script>
        $('#3012').on('click', function(e) {

            doData(12, 30);

        })
        </script>
        <button id="4012" class="btn btn-default">40</button>
        <script>
        $('#4012').on('click', function(e) {

            doData(12, 40);

        })
        </script>
        <button id="7012" class="btn btn-default">70</button>
        <script>
        $('#7012').on('click', function(e) {

            doData(12, 70);

        })
        </script>
    </div>
</div>
<p>&nbsp;</p>
<div id="container" style="height: 400px; min-width: 310px"></div>
<p>&nbsp;</p>
<div id="container2" style="height: 400px; min-width: 310px"></div>